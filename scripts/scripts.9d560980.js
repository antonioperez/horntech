$(document).ready(function(){function fix_height(){var heightWithoutNavbar=$("body > #wrapper").height()-61;$(".sidebar-panel").css("min-height",heightWithoutNavbar+"px");var navbarHeight=$("nav.navbar-default").height(),wrapperHeight=$("#page-wrapper").height();navbarHeight>wrapperHeight&&$("#page-wrapper").css("min-height",navbarHeight+"px"),navbarHeight<wrapperHeight&&$("#page-wrapper").css("min-height",$(window).height()+"px"),$("body").hasClass("fixed-nav")&&(navbarHeight>wrapperHeight?$("#page-wrapper").css("min-height",navbarHeight+"px"):$("#page-wrapper").css("min-height",$(window).height()-60+"px"))}$(window).bind("load resize scroll",function(){$("body").hasClass("body-small")||fix_height()}),$(window).scroll(function(){$(window).scrollTop()>0&&!$("body").hasClass("fixed-nav")?$("#right-sidebar").addClass("sidebar-top"):$("#right-sidebar").removeClass("sidebar-top")}),setTimeout(function(){fix_height()})}),$(window).bind("load resize",function(){$(document).width()<769?$("body").addClass("body-small"):$("body").removeClass("body-small")}),function(){angular.module("app",["localytics.directives","oc.lazyLoad","ui.router","ui.bootstrap","angularFileUpload","datePicker","ngSanitize","ngCookies","luegg.directives"])}(),function(){function config($stateProvider,$urlRouterProvider){$urlRouterProvider.otherwise("/report"),$stateProvider.state("index",{abstract:!0,url:"/index",templateUrl:"components/layout/content.html"})}function statesConfig($rootScope,$state,$cookies){$rootScope.$on("$stateChangeStart",function(evt,toState,toParams){})}angular.module("app").config(["$stateProvider","$urlRouterProvider",config]).run(["$rootScope","$state",function($rootScope,$state){$rootScope.$state=$state}]).run(["$rootScope","$state","$cookies",statesConfig])}(),function(){function pageTitle($rootScope,$timeout){return{link:function(scope,element){var listener=function(event,toState,toParams,fromState,fromParams){var title="Reports | Horn Technologies";toState.data&&toState.data.pageTitle&&(title="Reports | "+toState.data.pageTitle),$timeout(function(){element.text(title)})};$rootScope.$on("$stateChangeStart",listener)}}}function sideNavigation($timeout){return{restrict:"A",link:function(scope,element){($timeout(function(){element.metisMenu()}),$('#side-menu a:not([href$="\\#"])').click(function(){$(window).width()<769&&$("body").toggleClass("mini-navbar")}),$("body").hasClass("fixed-sidebar"))&&element.parent().slimScroll({height:"100%",railOpacity:.9})}}}function iboxTools($timeout){return{restrict:"A",scope:!0,templateUrl:"components/layout/ibox_tools.html",controller:["$scope","$element",function($scope,$element){$scope.showhide=function(){var ibox=$element.closest("div.ibox"),icon=$element.find("i:first");ibox.children(".ibox-content").slideToggle(200),icon.toggleClass("fa-chevron-up").toggleClass("fa-chevron-down"),ibox.toggleClass("").toggleClass("border-bottom"),$timeout(function(){ibox.resize(),ibox.find("[id^=map-]").resize()},50)},$scope.closebox=function(){$element.closest("div.ibox").remove()}}]}}function minimalizaSidebar($timeout){return{restrict:"A",template:'<a class="navbar-minimalize minimalize-styl-2 btn" href="" ng-click="minimalize()"><i class="fa fa-bars"></i></a>',controller:["$scope","$element",function($scope,$element){$scope.minimalize=function(){$("body").toggleClass("mini-navbar"),!$("body").hasClass("mini-navbar")||$("body").hasClass("body-small")?($("#side-menu").hide(),setTimeout(function(){$("#side-menu").fadeIn(400)},200)):$("body").hasClass("fixed-sidebar")?($("#side-menu").hide(),setTimeout(function(){$("#side-menu").fadeIn(400)},100)):$("#side-menu").removeAttr("style")}}]}}function iboxToolsFullScreen($timeout){return{restrict:"A",scope:!0,templateUrl:"components/layout/ibox_tools_full_screen.html",controller:["$scope","$element",function($scope,$element){$scope.showhide=function(){var ibox=$element.closest("div.ibox"),icon=$element.find("i:first");ibox.children(".ibox-content").slideToggle(200),icon.toggleClass("fa-chevron-up").toggleClass("fa-chevron-down"),ibox.toggleClass("").toggleClass("border-bottom"),$timeout(function(){ibox.resize(),ibox.find("[id^=map-]").resize()},50)},$scope.closebox=function(){$element.closest("div.ibox").remove()},$scope.fullscreen=function(){var ibox=$element.closest("div.ibox"),button=$element.find("i.fa-expand");$("body").toggleClass("fullscreen-ibox-mode"),button.toggleClass("fa-expand").toggleClass("fa-compress"),ibox.toggleClass("fullscreen"),setTimeout(function(){$(window).trigger("resize")},100)}}]}}angular.module("app").directive("pageTitle",["$rootScope","$timeout",pageTitle]).directive("sideNavigation",["$timeout",sideNavigation]).directive("iboxTools",["$timeout",iboxTools]).directive("minimalizaSidebar",["$timeout",minimalizaSidebar]).directive("iboxToolsFullScreen",["$timeout",iboxToolsFullScreen])}(),function(){function MainCtrl(){}angular.module("app").controller("MainCtrl",MainCtrl),angular.module("app").filter("capitalizeWord",function(){return function(text){return text?text.charAt(0).toUpperCase()+text.substr(1).toLowerCase():""}})}(),function(){function config($stateProvider){}angular.module("app").config(["$stateProvider",config])}(),function(){function Ctrl($http,$scope,$location,$state,$cookies){}angular.module("app").controller("AccountCtrl",["$http","$scope","$location","$state","$cookies",Ctrl])}(),function(){function Ctrl($http,$scope,FileUploader){$scope.uploader=new FileUploader({filters:[{name:"csvOnly",fn:function(item){return"text/csv"==item.type||($scope.errorMessage="CSV Files Only!",!1)}}]}),$scope.dataRows=[],$scope.errorMessage="",$scope.activeKey=0,$scope.formValues={treatment:"",customer:"",container:"",commodity:"",fumigant:"",dosage:"",startTime:"",endTime:"",exposure:"",certGas:"",fumigator:""},$scope.zoneModel={zone1:!0,zone2:!0,zone3:!0},$scope.xAxis=[],$scope.zone1=[],$scope.zone2=[],$scope.zone3=[],$scope.map=[{key:"uploader",template:"components/report/subviews/upload.html"},{key:"data",template:"components/report/subviews/data.html"},{key:"output",template:"components/report/subviews/output.html"},{key:"pdfpreview",template:"components/report/subviews/pdfpreview.html"}],$scope.activeView=$scope.map[$scope.activeKey],$scope.createPdf=function(){for(var prop in $scope.formValues)if($scope.formValues.hasOwnProperty(prop))for(var idx in fumiForm.content){var obj=fumiForm.content[idx];obj.hasOwnProperty("id")&&obj.id===prop&&(fumiForm.content[idx].text+=$scope.formValues[prop])}var canvas=document.getElementById("graphOutput"),imgData=(canvas.getContext("2d"),canvas.toDataURL());fumiForm.content.push({image:imgData,pageBreak:"after",width:500,height:500}),fumiForm.content.push(rawDataTable),pdfMake.createPdf(fumiForm).open()},$scope.uploader.uploadItem=function(value){var file=value._file;Papa.parse(file,{delimiter:";",worker:!0,skipEmptyLines:!0,step:function(results){var row=results.data[0].filter(function(x){return y=$.trim(x),null!==y}),date=moment(row[0]+" "+row[1],"DD.MM.YY h:mm:ss");row[0]=date.format("LLL"),row[2]=parseInt(row[2].replace(/,/g,".")),row[3]=parseInt(row[3].replace(/,/g,".")),row[4]=parseInt(row[4].replace(/,/g,".")),isNaN(row[2])&&(row[2]=0),isNaN(row[3])&&(row[3]=0),isNaN(row[4])&&(row[4]=0);var dataRow=[date.format("LLL"),row[2],row[3],row[4]];rawDataTable.table.body.push(dataRow),$scope.dataRows.push(row),$scope.$apply()}});var index=this.getIndexOfItem(value),item=this.queue[index],transport=this.isHTML5?"_xhrTransport":"_iframeTransport";item._prepareToUploading(),this.isUploading||(this._onBeforeUploadItem(item),item.isCancel||(item.isUploading=!0,this.isUploading=!0,this[transport](item),this._render()))},$scope.uploader.onCompleteAll=function(){$scope.activeKey+=1,$scope.activeView=$scope.map[$scope.activeKey]},$scope.lineData={labels:$scope.xAxis,datasets:[{label:"Zone 1",fill:!1,borderColor:"rgba(155,44,77,1)",backgroundColor:"rgba(155,44,77,.5)",data:$scope.zone1},{label:"Zone 2",fill:!1,borderColor:"rgba(41,37,172,1)",backgroundColor:"rgba(41,37,172,.5)",data:$scope.zone2},{label:"Zone 3",fill:!1,borderColor:"rgba(88,172,75,1)",backgroundColor:"rgba(88,172,75,.5)",data:$scope.zone3}]},$scope.graphConfig={type:"line",responsive:!0,title:{display:!0,text:"PH3 [PPM]"},data:$scope.lineData,options:{scales:{xAxes:[{gridLines:{offsetGridLines:!0},type:"time",distribution:"series",ticks:{source:"labels",major:{fontSize:"3"}},time:{unit:"hour",round:"hour",unitStepSize:2,tooltipFormat:"MMM D, h:mm A",displayFormats:{hour:"MMM D, h:mm A"}}}],yAxes:[{scaleLabel:{display:!0,labelString:"PPM"}}]},legend:{position:"bottom"}}},$scope.generateReport=function(){$scope.dataRows.forEach(function(data){var date=moment(data[0]).startOf("hour");$scope.xAxis.push(date),$scope.zoneModel.zone1&&$scope.zone1.push(data[2]),$scope.zoneModel.zone2&&$scope.zone2.push(data[3]),$scope.zoneModel.zone3&&$scope.zone3.push(data[4])});for(var parsedDates=[],i=0;i<$scope.xAxis.length;i+=10)parsedDates.push($scope.xAxis[i]);console.log($scope.xAxis),console.log(parsedDates),$scope.xAxis=parsedDates,$scope.activeKey+=1,$scope.activeView=$scope.map[$scope.activeKey]}}angular.module("app").directive("chart",function(){return{link:function(scope,elem,attrs){console.log(scope.graphConfig);var ctx=document.getElementById("graphOutput").getContext("2d");window.myLine=new Chart(ctx,scope.graphConfig)}}}),angular.module("app").controller("ReportCtrl",["$http","$scope","FileUploader",Ctrl])}(),function(){function config($stateProvider){$stateProvider.state("report",{controller:"ReportCtrl",controllerAs:"report",data:{pageTitle:""},resolve:{loadPlugin:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load([{name:"angles",files:["js/plugins/chartJs/angles.js"]}])}]},templateUrl:"components/report/report.html",url:"/report"})}angular.module("app").config(["$stateProvider",config])}();