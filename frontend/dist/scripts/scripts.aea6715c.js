$(document).ready(function(){function fix_height(){var heightWithoutNavbar=$("body > #wrapper").height()-61;$(".sidebar-panel").css("min-height",heightWithoutNavbar+"px");var navbarHeight=$("nav.navbar-default").height(),wrapperHeight=$("#page-wrapper").height();navbarHeight>wrapperHeight&&$("#page-wrapper").css("min-height",navbarHeight+"px"),navbarHeight<wrapperHeight&&$("#page-wrapper").css("min-height",$(window).height()+"px"),$("body").hasClass("fixed-nav")&&(navbarHeight>wrapperHeight?$("#page-wrapper").css("min-height",navbarHeight+"px"):$("#page-wrapper").css("min-height",$(window).height()-60+"px"))}$(window).bind("load resize scroll",function(){$("body").hasClass("body-small")||fix_height()}),$(window).scroll(function(){$(window).scrollTop()>0&&!$("body").hasClass("fixed-nav")?$("#right-sidebar").addClass("sidebar-top"):$("#right-sidebar").removeClass("sidebar-top")}),setTimeout(function(){fix_height()})}),$(window).bind("load resize",function(){$(document).width()<769?$("body").addClass("body-small"):$("body").removeClass("body-small")});var config={apiKey:"AIzaSyCLkRx0Al3hVjv0oo5ZvLVUDM7wqFInYGE",authDomain:"forex-family.firebaseapp.com",databaseURL:"https://forex-family.firebaseio.com",projectId:"forex-family",storageBucket:"forex-family.appspot.com",messagingSenderId:"912847206888"};firebase.initializeApp(config),function(){angular.module("app",["localytics.directives","oc.lazyLoad","ui.router","ui.bootstrap","angularFileUpload","datePicker","ngSanitize","ngCookies","luegg.directives"])}(),function(){function config($stateProvider,$urlRouterProvider){$urlRouterProvider.otherwise("/login"),$stateProvider.state("index",{abstract:!0,url:"/index",templateUrl:"components/layout/content.html"})}function statesConfig($rootScope,$state,$cookies){$rootScope.$on("$stateChangeStart",function(evt,toState,toParams){firebase.auth().currentUser;firebase.auth().onAuthStateChanged(function(user){user||"login"!==toState.name&&"register"!==toState.name&&(evt.preventDefault(),$state.go("login"))})})}angular.module("app").config(["$stateProvider","$urlRouterProvider",config]).run(["$rootScope","$state",function($rootScope,$state){$rootScope.$state=$state}]).run(["$rootScope","$state","$cookies",statesConfig])}(),function(){function pageTitle($rootScope,$timeout){return{link:function(scope,element){var listener=function(event,toState,toParams,fromState,fromParams){var title="Chat | Forex Family";toState.data&&toState.data.pageTitle&&(title="Forex | "+toState.data.pageTitle),$timeout(function(){element.text(title)})};$rootScope.$on("$stateChangeStart",listener)}}}function sideNavigation($timeout){return{restrict:"A",link:function(scope,element){($timeout(function(){element.metisMenu()}),$('#side-menu a:not([href$="\\#"])').click(function(){$(window).width()<769&&$("body").toggleClass("mini-navbar")}),$("body").hasClass("fixed-sidebar"))&&element.parent().slimScroll({height:"100%",railOpacity:.9})}}}function iboxTools($timeout){return{restrict:"A",scope:!0,templateUrl:"components/layout/ibox_tools.html",controller:["$scope","$element",function($scope,$element){$scope.showhide=function(){var ibox=$element.closest("div.ibox"),icon=$element.find("i:first");ibox.children(".ibox-content").slideToggle(200),icon.toggleClass("fa-chevron-up").toggleClass("fa-chevron-down"),ibox.toggleClass("").toggleClass("border-bottom"),$timeout(function(){ibox.resize(),ibox.find("[id^=map-]").resize()},50)},$scope.closebox=function(){$element.closest("div.ibox").remove()}}]}}function minimalizaSidebar($timeout){return{restrict:"A",template:'<a class="navbar-minimalize minimalize-styl-2 btn" href="" ng-click="minimalize()"><i class="fa fa-bars"></i></a>',controller:["$scope","$element",function($scope,$element){$scope.minimalize=function(){$("body").toggleClass("mini-navbar"),!$("body").hasClass("mini-navbar")||$("body").hasClass("body-small")?($("#side-menu").hide(),setTimeout(function(){$("#side-menu").fadeIn(400)},200)):$("body").hasClass("fixed-sidebar")?($("#side-menu").hide(),setTimeout(function(){$("#side-menu").fadeIn(400)},100)):$("#side-menu").removeAttr("style")}}]}}function iboxToolsFullScreen($timeout){return{restrict:"A",scope:!0,templateUrl:"components/layout/ibox_tools_full_screen.html",controller:["$scope","$element",function($scope,$element){$scope.showhide=function(){var ibox=$element.closest("div.ibox"),icon=$element.find("i:first");ibox.children(".ibox-content").slideToggle(200),icon.toggleClass("fa-chevron-up").toggleClass("fa-chevron-down"),ibox.toggleClass("").toggleClass("border-bottom"),$timeout(function(){ibox.resize(),ibox.find("[id^=map-]").resize()},50)},$scope.closebox=function(){$element.closest("div.ibox").remove()},$scope.fullscreen=function(){var ibox=$element.closest("div.ibox"),button=$element.find("i.fa-expand");$("body").toggleClass("fullscreen-ibox-mode"),button.toggleClass("fa-expand").toggleClass("fa-compress"),ibox.toggleClass("fullscreen"),setTimeout(function(){$(window).trigger("resize")},100)}}]}}angular.module("app").directive("pageTitle",["$rootScope","$timeout",pageTitle]).directive("sideNavigation",["$timeout",sideNavigation]).directive("iboxTools",["$timeout",iboxTools]).directive("minimalizaSidebar",["$timeout",minimalizaSidebar]).directive("iboxToolsFullScreen",["$timeout",iboxToolsFullScreen])}(),function(){function MainCtrl(){var self=this;firebase.auth();firebase.auth().onAuthStateChanged(function(user){user&&(self.currentUser=user)})}angular.module("app").controller("MainCtrl",MainCtrl),angular.module("app").filter("capitalizeWord",function(){return function(text){return text?text.charAt(0).toUpperCase()+text.substr(1).toLowerCase():""}})}(),function(){function config($stateProvider){$stateProvider.state("login",{url:"/login",controller:"AccountCtrl",controllerAs:"account",templateUrl:"components/account/login.html",data:{pageTitle:"Login"}}).state("forgot_password",{controller:"AccountCtrl",controllerAs:"account",url:"/forgot_password",templateUrl:"components/account/forgot.password.html",data:{pageTitle:"Forgot password",specialClass:"gray-bg"}}).state("register",{controller:"AccountCtrl",controllerAs:"account",url:"/register",templateUrl:"components/account/register.html",data:{pageTitle:"Register",specialClass:"gray-bg"}})}angular.module("app").config(["$stateProvider",config])}(),function(){function Ctrl($http,$scope,$location,$state,$cookies){function sendPasswordReset(email){auth.sendPasswordResetEmail(email).then(function(){$scope.message="Password Reset Email Sent!"}).catch(function(error){var errorMessage=error.message;$scope.errorMessage=errorMessage})}var auth=firebase.auth(),self=this;self.database=firebase.database(),$scope.email="user@forexfamily.com",$scope.password="demo123";var sendEmailVerification=function(){auth.currentUser.sendEmailVerification().then(function(){console.log("Email Verification Sent!")})},signin=function(email,password){$state.go("index.chat"),auth.signInWithEmailAndPassword(email,password).then(function(user){$cookies.put("user",user),self.database.ref("user/"+user.uid).update({online:!0}),$state.go("index.chat")}).catch(function(error){var errorCode=error.code,errorMessage=error.message;"auth/wrong-password"===errorCode?console.log("Wrong password."):console.log(errorMessage),$scope.errorMessage=errorMessage})},signup=function(email,password,username){auth.createUserWithEmailAndPassword(email,password).then(function(user){sendEmailVerification(),$cookies.put("user",user),username||(username=user.displayName),user.updateProfile({displayName:username}),self.database.ref("user/"+user.uid).set({online:!0,username:username,likes:0}),$state.go("index.chat")}).catch(function(error){var errorMessage=error.message;$scope.errorMessage=errorMessage})};$scope.socialLogin=function(provider){switch(provider){case"facebook":provider=new firebase.auth.FacebookAuthProvider;break;case"google":provider=new firebase.auth.GoogleAuthProvider;break;case"twitter":provider=new firebase.auth.TwitterAuthProvider}auth.signInWithPopup(provider).then(function(user){user=user.user,$cookies.put("user",user),self.database.ref("user/"+user.uid).set({online:!0,username:user.displayName,likes:0}),$state.go("index.chat")},function(error){var errorMessage=error.message;$scope.errorMessage=errorMessage,console.error("Login failed: "+error.code)})},$scope.sendPasswordReset=function(){sendPasswordReset($scope.email)},$scope.signIn=function(){return auth.currentUser&&auth.signOut(),$scope.password=$scope.password.trim(),$scope.email=$scope.email.trim(),$scope.email.length<1?void alert("Please enter an email address."):$scope.password.length<4?void alert("Your Password is too short"):void signin($scope.email,$scope.password)},$scope.signUp=function(){return $scope.password=$scope.password.trim(),$scope.email=$scope.email.trim(),$scope.username=$scope.username.trim(),$scope.email.length<1?void alert("Please enter an email address."):$scope.password.length<1?void alert("Please enter a password."):void signup($scope.email,$scope.password,$scope.username)},$scope.signOut=function(){auth.currentUser&&(self.database.ref("user/"+auth.currentUser.uid).update({online:!1}),auth.signOut(),$cookies.remove("user"),$state.go("login"))}}angular.module("app").controller("AccountCtrl",["$http","$scope","$location","$state","$cookies",Ctrl])}(),angular.module("app").service("chatservice",["$q",function($q){var self=this;self.defaultChatName="public",self.activeChatKey="",self.activeChat={},self.auth=firebase.auth(),self.storageRef=firebase.storage().ref(),self.database=firebase.database(),firebase.auth().onAuthStateChanged(function(user){user&&(self.currentUser=user)}),self.getActiveChat=function(){return self.activeChat},self.setActiveChat=function(value){self.activeChat=value},self.getChatRoom=function(chatRoom){chatRoom||(chatRoom=self.defaultChatName);var defer=$q.defer(),roomsRef=self.database.ref("rooms");roomsRef.orderByChild("name").equalTo(chatRoom).on("value",function(snapshot){snapshot.forEach(function(data){self.activeChat=data.val(),self.activeChatKey=data.key,self.activeChat=data.val(),self.activeChat.key=data.key,defer.resolve(self.activeChat)})},function(errorObject){defer.resolve(errorObject),console.log("The read failed: "+errorObject.code)});return defer.promise}}]),function(){function config($stateProvider){$stateProvider.state("index.chat",{controller:"ChatRoomCtrl",controllerAs:"chatroom",data:{pageTitle:"Chat"},resolve:{loadPlugin:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load([{name:"angles",files:["js/plugins/chartJs/angles.js"]},{files:["js/plugins/chartJs/Chart.min.js"]},{serie:!0,name:"angular-flot",files:["js/plugins/flot/jquery.flot.js","js/plugins/flot/jquery.flot.time.js","js/plugins/flot/jquery.flot.tooltip.min.js","js/plugins/flot/jquery.flot.spline.js","js/plugins/flot/jquery.flot.resize.js","js/plugins/flot/jquery.flot.pie.js","js/plugins/flot/curvedLines.js","js/plugins/flot/angular-flot.js"]},{serie:!0,files:["js/plugins/jvectormap/jquery-jvectormap-2.0.2.min.js","js/plugins/jvectormap/jquery-jvectormap-2.0.2.css"]},{serie:!0,files:["js/plugins/jvectormap/jquery-jvectormap-world-mill-en.js"]},{name:"ui.checkbox",files:["js/bootstrap/angular-bootstrap-checkbox.js"]},{serie:!0,files:["css/plugins/c3/c3.min.css","js/plugins/d3/d3.min.js","js/plugins/c3/c3.min.js"]},{serie:!0,name:"gridshore.c3js.chart",files:["js/plugins/c3/c3-angular.min.js"]}])}]},templateUrl:"components/chat/chat.html",url:"/chat"})}angular.module("app").config(["$stateProvider",config])}(),function(){function Ctrl($http,$rootScope,$timeout,chatservice){var self=this,database=(chatservice.auth,chatservice.storageRef,chatservice.database);self.currentUser=chatservice.currentUser,self.activeRoom={},$timeout(function(){chatservice.getChatRoom().then(function(result){self.activeRoom=result,$rootScope.activeChatKey=result.key,self.loadRooms()})},0),self.rooms={};var setRooms=function(data){$timeout(function(){var val=data.val(),key=data.key;self.rooms[key]=val},0)};self.loadRooms=function(){var loadLimit=12;this.roomsRef=database.ref("rooms"),this.roomsRef.off(),this.roomsRef.limitToLast(loadLimit).on("child_added",setRooms),this.roomsRef.limitToLast(loadLimit).on("child_changed",setRooms),this.roomsRef.limitToLast(loadLimit).on("child_removed",setRooms)},self.changeRooms=function(room){chatservice.getChatRoom(room).then(function(result){self.activeRoom=result,$rootScope.activeChatKey=result.key})}}angular.module("app").controller("ChatRoomCtrl",["$http","$rootScope","$timeout","chatservice",Ctrl])}(),function(){function Ctrl($http,$rootScope,$timeout,chatservice){var self=this,database=(chatservice.auth,chatservice.storageRef,chatservice.database);self.currentUser=database.currentUser,self.messages={},$timeout(function(){chatservice.getChatRoom().then(function(result){self.loadMessages()})},0);var setMessage=function(data){$timeout(function(){var val=data.val(),key=data.key;self.messages[key]=val},0)};self.loadMessages=function(){var loadLimit=12;this.messagesRef=database.ref("rooms/"+$rootScope.activeChatKey+"/messages"),this.messagesRef.off(),this.messagesRef.limitToLast(loadLimit).on("child_added",setMessage),this.messagesRef.limitToLast(loadLimit).on("child_changed",setMessage),this.messagesRef.limitToLast(loadLimit).on("child_removed",setMessage)},$rootScope.$watch("activeChatKey",function(){self.messages={},self.loadMessages()})}angular.module("app").controller("ChatCtrl",["$http","$rootScope","$timeout","chatservice",Ctrl])}(),function(){function Ctrl($http,$scope,$timeout,chatservice){var self=this,database=(chatservice.auth,chatservice.storageRef,chatservice.database);self.currentUser=chatservice.currentUser,self.activeRoom=chatservice.getActiveChat(),self.messages={},self.users={};var setUsers=function(data){$timeout(function(){var val=data.val(),key=data.key;self.users[key]=val},0)};self.loadUsers=function(){var loadLimit=25;this.messagesRef=database.ref("user"),this.messagesRef.off(),this.messagesRef.limitToLast(loadLimit).on("child_added",setUsers),this.messagesRef.limitToLast(loadLimit).on("child_changed",setUsers),this.messagesRef.limitToLast(loadLimit).on("child_removed",setUsers)},self.loadUsers()}angular.module("app").controller("ChatUsersCtrl",["$http","$scope","$timeout","chatservice",Ctrl])}(),function(){function Ctrl($http,$timeout,$rootScope,FileUploader,chatservice){function writeUserData(userId,filename,size,downloadUrl,lastModified){var encodedData=window.btoa(filename);database.ref("rooms/"+$rootScope.activeChatKey+"/uploads/"+userId).child(encodedData).set({name:filename,size:size,downloadUrl:downloadUrl,lastModified:lastModified});var mess='<a target="_blank" href="'+downloadUrl+'" class="downloadLink" ><strong >'+filename+"</strong></a>";self.saveMessage(mess)}var self=this;self.uploader=new FileUploader;var storageRef=(chatservice.auth,chatservice.storageRef),database=chatservice.database;self.currentUser=chatservice.currentUser,self.saveMessage=function(message){var currentUser=self.currentUser,textfield=$("#summernote");messageInput=textfield.summernote("code");var plainText=$(messageInput).text();if(message&&(messageInput=message,plainText=message),messageInput&&currentUser&&plainText.length>0){var milliseconds=Math.floor((new Date).getTime()/1e3);this.messagesRef=database.ref("rooms/"+$rootScope.activeChatKey+"/messages"),this.messagesRef.push({userid:currentUser.uid,name:currentUser.displayName,text:messageInput,time:milliseconds,photoUrl:currentUser.photoURL||"/components/layout/logo.png"}).then(function(){textfield.summernote("reset")}).catch(function(error){console.error("Error writing new message to Firebase Database",error)})}},self.uploader.uploadItem=function(value){var hash=(1e32*Math.random()).toString(36),currentUser=self.currentUser,vm=this,file=value._file;storageRef.child($rootScope.activeChatKey+"/user/"+currentUser.uid+"/"+hash).put(file).then(function(snapshot){var downloadURL=snapshot.downloadURL;item.isSuccess=!0,item.isCancel=!1,item.isError=!1,writeUserData(currentUser.uid,file.name,file.size,downloadURL,file.lastModified),vm.clearQueue(),vm._render()},function(error){console.log(error)});var index=this.getIndexOfItem(value),item=this.queue[index],transport=this.isHTML5?"_xhrTransport":"_iframeTransport";item._prepareToUploading(),this.isUploading||(this._onBeforeUploadItem(item),item.isCancel||(item.isUploading=!0,this.isUploading=!0,this[transport](item),this.clearQueue(),this._render()))}}angular.module("app").controller("ChatMessageCtrl",["$http","$timeout","$rootScope","FileUploader","chatservice",Ctrl])}();